!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("jsqr"),require("rxjs"),require("@angular/core")):"function"==typeof define&&define.amd?define("ngx-scanner-qrcode-single",["exports","jsqr","rxjs","@angular/core"],e):e(t["ngx-scanner-qrcode-single"]={},t.jsqr,t.rxjs,t.ng.core)}(this,function(t,p,a,e){"use strict";p=p&&p.hasOwnProperty("default")?p["default"]:p;var s=function(){return(s=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function f(t,a,s,c){return new(s||(s=Promise))(function(e,n){function i(t){try{o(c.next(t))}catch(e){n(e)}}function r(t){try{o(c["throw"](t))}catch(e){n(e)}}function o(t){t.done?e(t.value):function n(e){return e instanceof s?e:new s(function(t){t(e)})}(t.value).then(i,r)}o((c=c.apply(t,a||[])).next())})}function g(i,r){var o,a,s,t,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return t={next:e(0),"throw":e(1),"return":e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function n(t){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,a&&(s=2&t[0]?a["return"]:t[0]?a["throw"]||((s=a["return"])&&s.call(a),0):a.next)&&!(s=s.call(a,t[1])).done)return s;switch(a=0,s&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return c.label++,{value:t[1],done:!1};case 5:c.label++,a=t[1],t=[0];continue;case 7:t=c.ops.pop(),c.trys.pop();continue;default:if(!(s=0<(s=c.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){c=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){c.label=t[1];break}if(6===t[0]&&c.label<s[1]){c.label=s[1],s=t;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(t);break}s[2]&&c.ops.pop(),c.trys.pop();continue}t=r.call(i,c)}catch(e){t=[6,e],a=0}finally{o=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([e,t])}}}function n(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,r,o=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(i=o.next()).done;)a.push(i.value)}catch(s){r={error:s}}finally{try{i&&!i.done&&(n=o["return"])&&n.call(o)}finally{if(r)throw r.error}}return a}function L(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(n(arguments[e]));return t}var i={audio:!1,video:!0},r={src:"",fps:30,vibrate:300,isBeep:!0,constraints:i,canvasStyles:{font:"15px serif",lineWidth:1,strokeStyle:"green",fillStyle:"#55f02880"}},o=this,M=function(t,e){return!!e.split(".").reduce(function(t,e){return t&&t[e]?t[e]:undefined},t)},c=function(t,e,n){n?t.error(n):t.next(e),t.complete()},v=function(t){if(void 0===t&&(t=!1),!1!==t){var e=new Audio("data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU"+Array(300).join("101"));e.oncanplaythrough=function(){var t=e.play();t&&t["catch"](function(t){"NotAllowedError"===t.name||t.name})}}},l=function(t,e,n,a){var i,r,o=e.width,s=e.height,c=o/s,l=parseInt(getComputedStyle(e).width),u=parseInt(getComputedStyle(e).height),d=l/u;n.innerHTML="",d<c?(i=l/o,r=l/c/s):(r=u/s,i=u*c/o);var h=document.createElement("canvas"),p=h.getContext("2d",{willReadFrequently:!0}),v={},f=[],g=[],m=0,y=0,b=M(a,"font.replace")&&a.font.replace(/[^0-9]/g,"");/[0-9]/g.test(b)&&(y=(i||1)*(m=parseFloat(b)),Number.isNaN(y)&&(y=m));var w=t.location,x=function(t,e,n){for(var i in p.beginPath(),p.moveTo(t.x,t.y),p.lineTo(e.x,e.y),a)p[i]=a[i];p.stroke();var r=M(t,"x")?t.x:0,o=M(t,"y")?t.y:0;v["x"+(n+1)]=r,v["y"+(n+1)]=o,f.push(r),g.push(o)};x(w.topLeftCorner,w.topRightCorner,0),x(w.topRightCorner,w.bottomRightCorner,1),x(w.bottomRightCorner,w.bottomLeftCorner,2),x(w.bottomLeftCorner,w.topLeftCorner,3);var S=Math.max.apply(Math,L(f)),T=Math.min.apply(Math,L(f)),A=Math.max.apply(Math,L(g)),F=Math.min.apply(Math,L(g));for(var k in h.setAttribute("class","qrcode-polygon"),d<c?(h.style.top=F*r+.5*(u-l/c)+"px",h.style.left=T*i+"px",h.width=(S-T)*i,h.height=(A-F)*i):(h.style.top=F*r+"px",h.style.left=T*i+.5*(l-u*c)+"px",h.width=(S-T)*r,h.height=(A-F)*r),a)p[k]=a[k];for(var E=[],O=0;O<f.length;O++)E.push((v["x"+(O+1)]-T)*r),E.push((v["y"+(O+1)]-F)*i);var j=E.slice(0);for(p.beginPath(),p.moveTo(j.shift(),j.shift());j.length;)p.lineTo(j.shift(),j.shift());if(p.closePath(),p.fill(),p.stroke(),m){var C=document.createElement("div");C.setAttribute("class","qrcode-tooltip-temp"),C.innerText=t.data;var I='<?xml version="1.0" encoding="utf-8"?><svg version="1.1" class="qrcode-tooltip-clipboard" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+y+'" height="'+y+'" x="0px" y="0px" viewBox="0 0 115.77 122.88" xml:space="preserve"><g><path d="M89.62,13.96v7.73h12.19h0.01v0.02c3.85,0.01,7.34,1.57,9.86,4.1c2.5,2.51,4.06,5.98,4.07,9.82h0.02v0.02 v73.27v0.01h-0.02c-0.01,3.84-1.57,7.33-4.1,9.86c-2.51,2.5-5.98,4.06-9.82,4.07v0.02h-0.02h-61.7H40.1v-0.02 c-3.84-0.01-7.34-1.57-9.86-4.1c-2.5-2.51-4.06-5.98-4.07-9.82h-0.02v-0.02V92.51H13.96h-0.01v-0.02c-3.84-0.01-7.34-1.57-9.86-4.1 c-2.5-2.51-4.06-5.98-4.07-9.82H0v-0.02V13.96v-0.01h0.02c0.01-3.85,1.58-7.34,4.1-9.86c2.51-2.5,5.98-4.06,9.82-4.07V0h0.02h61.7 h0.01v0.02c3.85,0.01,7.34,1.57,9.86,4.1c2.5,2.51,4.06,5.98,4.07,9.82h0.02V13.96L89.62,13.96z M79.04,21.69v-7.73v-0.02h0.02 c0-0.91-0.39-1.75-1.01-2.37c-0.61-0.61-1.46-1-2.37-1v0.02h-0.01h-61.7h-0.02v-0.02c-0.91,0-1.75,0.39-2.37,1.01 c-0.61,0.61-1,1.46-1,2.37h0.02v0.01v64.59v0.02h-0.02c0,0.91,0.39,1.75,1.01,2.37c0.61,0.61,1.46,1,2.37,1v-0.02h0.01h12.19V35.65 v-0.01h0.02c0.01-3.85,1.58-7.34,4.1-9.86c2.51-2.5,5.98-4.06,9.82-4.07v-0.02h0.02H79.04L79.04,21.69z M105.18,108.92V35.65v-0.02 h0.02c0-0.91-0.39-1.75-1.01-2.37c-0.61-0.61-1.46-1-2.37-1v0.02h-0.01h-61.7h-0.02v-0.02c-0.91,0-1.75,0.39-2.37,1.01 c-0.61,0.61-1,1.46-1,2.37h0.02v0.01v73.27v0.02h-0.02c0,0.91,0.39,1.75,1.01,2.37c0.61,0.61,1.46,1,2.37,1v-0.02h0.01h61.7h0.02 v0.02c0.91,0,1.75-0.39,2.37-1.01c0.61-0.61,1-1.46,1-2.37h-0.02V108.92L105.18,108.92z"></path></g></svg> ',U=(new DOMParser).parseFromString(I,"application/xml"),q=C.ownerDocument.importNode(U.documentElement,!0);C.appendChild(q),q.addEventListener("click",function(){return window.navigator.clipboard.writeText(t.data)});var P=document.createElement("div");P.setAttribute("class","qrcode-tooltip"),P.appendChild(C),r=u/s,i=u*c/o,P.style.fontSize=i*m+"px",P.style.top=F*r+"px",P.style.left=T*i+.5*(l-u*c)+"px",P.style.width=(S-T)*r+"px",P.style.height=(A-F)*r+"px";var R=document.createElement("span");R.innerText=t.data,R.style.fontSize=i*m+"px",R.style.top=F*r+-20*r+"px",R.style.left=T*i+.5*(l-u*c)+"px",n&&n.appendChild(P),n&&n.appendChild(R)}n&&n.appendChild(h)},u=function(n,t){var d=t&&t.canvasStyles?t.canvasStyles:r.canvasStyles,h=t&&t.isBeep?t.isBeep:r.isBeep;return new Promise(function(u,e){var t=new FileReader;t.onload=function(){var c={name:n.name,file:n,url:URL.createObjectURL(n)},l=new Image;l.setAttribute("crossOrigin","anonymous"),l.onload=function(){return f(o,void 0,void 0,function(){var e,n,i,r,o,a,s;return g(this,function(t){switch(t.label){case 0:return(e=document.createElement("canvas")).width=l.naturalWidth||l.width,e.height=l.naturalHeight||l.height,(n=e.getContext("2d")).drawImage(l,0,0,e.width,e.height),i=n.getImageData(0,0,e.width,e.height),(r=p(i.data,i.width,i.height,{inversionAttempts:"dontInvert"}))&&""!==r.data?(function(t,e,a){var s=e.getContext("2d",{willReadFrequently:!0}),c={},l=[],u=[],n=t.location,i=function(t,e,n){for(var i in s.beginPath(),s.moveTo(t.x,t.y),s.lineTo(e.x,e.y),a)s[i]=a[i];s.stroke();var r=M(t,"x")?t.x:0,o=M(t,"y")?t.y:0;c["x"+(n+1)]=r,c["y"+(n+1)]=o,l.push(r),u.push(o)};i(n.topLeftCorner,n.topRightCorner,0),i(n.topRightCorner,n.bottomRightCorner,1),i(n.bottomRightCorner,n.bottomLeftCorner,2),i(n.bottomLeftCorner,n.topLeftCorner,3);var r=Math.min.apply(Math,L(l)),o=Math.min.apply(Math,L(u));for(var d in a)s[d]=a[d];s.font=a&&a.font?a.font:"15px serif",y(s,t.data,r,o-5);for(var h=[],p=0;p<l.length;p++)h.push(c["x"+(p+1)]),h.push(c["y"+(p+1)]);var v=h.slice(0);for(s.beginPath(),s.moveTo(v.shift(),v.shift());v.length;)s.lineTo(v.shift(),v.shift());s.closePath(),s.fill(),s.stroke()}(r,e,d),[4,m(e)]):[3,2];case 1:return o=t.sent(),a=URL.createObjectURL(o),s=function(t,e){return new File([t],e,{lastModified:(new Date).getTime(),type:t.type})},u(Object.assign({},c,{data:r,url:a,canvas:e,file:s(o,c.name)})),v(h),[3,3];case 2:u(Object.assign({},c,{data:r,canvas:e})),t.label=3;case 3:return[2]}})})},l.src=c.url},t.onerror=function(t){return e(t)},t.readAsDataURL(n)})},m=function(n,i){return new Promise(function(e,t){return n.toBlob(function(t){return e(t)},i)})},d=function(t,e,n){return void 0===t&&(t=[]),void 0===n&&(n=new a.AsyncSubject),Promise.all(Object.assign([],t).map(function(t){return u(t,e)})).then(function(t){c(n,t)})["catch"](function(t){return c(n,null,t)}),n},y=function(t,e,n,i){for(var r=1.2*t.measureText("M").width,o=e.split("\n"),a=0;a<o.length;++a)t.fillText(o[a],n,i),t.strokeText(o[a],n,i),i+=r},h=function(h,p,v){return f(o,void 0,void 0,function(){var e,n,i,o,a,s,c,l,u,d=this;return g(this,function(t){switch(t.label){case 0:if(!h.length)return[2];i=function(r){return f(d,void 0,void 0,function(){var e,n,i;return g(this,function(t){switch(t.label){case 0:return[4,createImageBitmap(r)];case 1:return e=t.sent(),(n=document.createElement("canvas")).width=e.width,n.height=e.height,n.getContext("2d").drawImage(e,0,0),[4,new Promise(function(t){return n.toBlob(t,v,p)})];case 2:return i=t.sent(),[2,new File([i],r.name,{type:i.type})]}})})},o=new DataTransfer,t.label=1;case 1:t.trys.push([1,6,7,8]),a=function r(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(h),s=a.next(),t.label=2;case 2:return s.done?[3,5]:(c=s.value).type.startsWith("image")?[4,i(c)]:(o.items.add(c),[3,4]);case 3:l=t.sent(),o.items.add(l),t.label=4;case 4:return s=a.next(),[3,2];case 5:return[3,8];case 6:return u=t.sent(),e={error:u},[3,8];case 7:try{s&&!s.done&&(n=a["return"])&&n.call(a)}finally{if(e)throw e.error}return[7];case 8:return[2,o.files]}})})},b=function(e){Object.assign([],e.childNodes).forEach(function(t){return e.removeChild(t)})},w=function(t){void 0===t&&(t=300),t&&x()&&window.navigator.vibrate(t)},x=function(){var t=navigator.userAgent||navigator.vendor||window.opera;return!(!/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)&&!/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(t.substr(0,4))||/^((?!chrome|android).)*safari/i.test(t))},S=function(){function t(){}return t.prototype.loadFiles=function(t,e,n){var i=this;void 0===t&&(t=[]),void 0===e&&(e=.5),void 0===n&&(n="image/jpeg");var r=new a.AsyncSubject;return h(t,e,n).then(function(t){Promise.all(Object.assign([],t).map(function(t){return i.readAsDataURL(t)})).then(function(t){return c(r,t)})["catch"](function(t){return c(r,null,t)})})["catch"](function(t){c(r,null,t)}),r},t.prototype.loadFilesToScan=function(t,e,n,i){void 0===t&&(t=[]),void 0===n&&(n=.5),void 0===i&&(i="image/jpeg");var r=new a.AsyncSubject;return h(t,n,i).then(function(t){d(t,e,r)})["catch"](function(t){c(r,null,t)}),r},t.prototype.readAsDataURL=function(i){return new Promise(function(e,n){var t=new FileReader;t.onload=function(){var t={name:i.name,file:i,url:URL.createObjectURL(i)};e(t)},t.onerror=function(t){return n(t)},t.readAsDataURL(i)})},t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ngInjectableDef=e.defineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}(),T=function(){function t(){var t=this;this.event=new e.EventEmitter,this.src=r.src,this.fps=r.fps,this.vibrate=r.vibrate,this.isBeep=r.isBeep,this.config=r,this.constraints=r.constraints,this.canvasStyles=r.canvasStyles,this.isStart=!1,this.isPause=!1,this.isLoading=!1,this.isTorch=!1,this.data=new a.BehaviorSubject(null),this.devices=new a.BehaviorSubject([]),this.deviceIndexActive=0,this.ready=new a.AsyncSubject,this.STATUS={startON:function(){return t.isStart=!0},pauseON:function(){return t.isPause=!0},loadingON:function(){return t.isLoading=!0},startOFF:function(){return t.isStart=!1},pauseOFF:function(){return t.isPause=!1},loadingOFF:function(){return t.isLoading=!1},torchOFF:function(){return t.isTorch=!1}}}return t.prototype.ngOnInit=function(){this.overrideConfig(),this.src&&this.loadImage(this.src),this.resize()},t.prototype.ngAfterViewInit=function(){var t=this;setTimeout(function(){return c(t.ready,!0)},1e3)},t.prototype.start=function(t){var e=new a.AsyncSubject;return this.isStart?c(e,!1):this.safariWebRTC(e,t),e},t.prototype.stop=function(){this.STATUS.pauseOFF(),this.STATUS.startOFF(),this.STATUS.torchOFF(),this.STATUS.loadingOFF();var e=new a.AsyncSubject;try{clearInterval(this.rAF_ID),this.video.nativeElement.srcObject.getTracks().forEach(function(t){t.stop(),c(e,!0)}),b(this.resultsPanel.nativeElement)}catch(t){c(e,!1,t)}return e},t.prototype.play=function(){var t=new a.AsyncSubject;return this.isPause?(this.video.nativeElement.play(),this.STATUS.pauseOFF(),this.requestAnimationFrame(90),c(t,!0)):c(t,!1),t},t.prototype.pause=function(){var t=new a.AsyncSubject;return this.isStart?(clearInterval(this.rAF_ID),this.video.nativeElement.pause(),this.STATUS.pauseON(),c(t,!0)):c(t,!1),t},t.prototype.playDevice=function(e,n){var i=this;void 0===n&&(n=new a.AsyncSubject);var t=!this.isStart||this.getConstraints().deviceId!==e;switch(!0){case"null"===e||"undefined"===e||!e:stop(),this.stop(),c(n,!1);break;case e&&t:stop(),this.stop(),this.STATUS.loadingON(),this.deviceIndexActive=this.devices.value.findIndex(function(t){return t.deviceId===e});var r=s({},this.constraints,{audio:!1,video:s({deviceId:e},this.constraints.video)});navigator.mediaDevices.getUserMedia(r).then(function(t){i.video.nativeElement.srcObject=t,i.video.nativeElement.onloadedmetadata=function(){i.video.nativeElement.play(),i.requestAnimationFrame(),c(n,!0),i.STATUS.startON(),i.STATUS.loadingOFF()}})["catch"](function(t){i.eventEmit(!1),c(n,!1,t),i.STATUS.startOFF(),i.STATUS.loadingOFF()});break;default:c(n,!1),this.STATUS.loadingOFF()}return n},t.prototype.loadImage=function(t){var e=this,n=new a.AsyncSubject;this.STATUS.startOFF(),this.STATUS.loadingON();var i=new Image;return i.setAttribute("crossOrigin","anonymous"),i.onload=function(){e.drawImage(i,function(t){c(n,t),e.STATUS.startOFF(),e.STATUS.loadingOFF()})},i.src=t,n},t.prototype.torcher=function(){var t=this,e=this.applyConstraints({advanced:[{torch:this.isTorch}]});return e.subscribe(function(){return!1},function(){return t.isTorch=!t.isTorch}),e},t.prototype.applyConstraints=function(e){var t=this,n=new a.AsyncSubject,i=this.video.nativeElement.srcObject.getVideoTracks()[0];return new window.ImageCapture(i).getPhotoCapabilities().then(function(){return f(t,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return[4,i.applyConstraints(e)];case 1:return t.sent(),c(n,!0),[2]}})})})["catch"](function(t){switch(t&&t.name){case"NotFoundError":case"DevicesNotFoundError":c(n,!1,"Required track is missing");break;case"NotReadableError":case"TrackStartError":c(n,!1,"Webcam or mic are already in use");break;case"OverconstrainedError":case"ConstraintNotSatisfiedError":c(n,!1,"Constraints can not be satisfied by avb. devices");break;case"NotAllowedError":case"PermissionDeniedError":c(n,!1,"Permission denied in browser");break;case"TypeError":c(n,!1,"Empty constraints object");break;default:c(n,!1,t)}}),n},t.prototype.getConstraints=function(){var t=this.video.nativeElement.srcObject,e=t&&t.getVideoTracks()[0];return e&&e.getConstraints()},t.prototype.download=function(r){var t=this;void 0===r&&(r="ngx-scanner-qrcode-single-"+Date.now()+".png");var o=new a.AsyncSubject;return f(t,void 0,void 0,function(){var n,i;return g(this,function(t){switch(t.label){case 0:return[4,m(this.canvas.nativeElement)];case 1:return n=t.sent(),e=n,i=new File([e],r,{lastModified:(new Date).getTime(),type:e.type}),d([i],this.config,o).subscribe(function(t){t.forEach(function(t){var e=document.createElement("a");e.href=t.url,e.download=t.name,e.click(),e.remove()})}),[2]}var e})}),o},t.prototype.resize=function(){var t=this;window.addEventListener("resize",function(){t.dataForResize&&l(t.dataForResize,t.canvas.nativeElement,t.resultsPanel.nativeElement,t.canvasStyles)})},t.prototype.overrideConfig=function(){M(this.config,"src")&&(this.src=this.config.src),M(this.config,"fps")&&(this.fps=this.config.fps),M(this.config,"vibrate")&&(this.vibrate=this.config.vibrate),M(this.config,"isBeep")&&(this.isBeep=this.config.isBeep),M(this.config,"constraints")&&(this.constraints=function(t,e,n){var i;if(e&&Object.keys(e[t]).length){for(var r in n){var o=JSON.parse(JSON.stringify(s({},e[t],((i={})[r]=n[r],i))));e[t]=e[t]&&e[t].hasOwnProperty(r)?e[t]:o}return e[t]}return n}("constraints",this.config,i)),M(this.config,"canvasStyles")&&(this.canvasStyles=this.config.canvasStyles)},t.prototype.safariWebRTC=function(e,n){var i=this;this.STATUS.startOFF(),this.STATUS.loadingON(),navigator.mediaDevices.getUserMedia(this.constraints).then(function(t){t.getTracks().forEach(function(t){return t.stop()}),i.loadAllDevices(e,n)})["catch"](function(t){c(e,!1,t),i.STATUS.startOFF(),i.STATUS.loadingOFF()})},t.prototype.loadAllDevices=function(n,i){var r=this;navigator.mediaDevices.enumerateDevices().then(function(t){var e=t.filter(function(t){return"videoinput"==t.kind});r.devices.next(e),0<e.length?(c(n,e),i?i(e):r.playDevice(e[0].deviceId)):(c(n,!1,"No camera detected."),r.STATUS.startOFF(),r.STATUS.loadingOFF())})["catch"](function(t){c(n,!1,t),r.STATUS.startOFF(),r.STATUS.loadingOFF()})},t.prototype.drawImage=function(s,c){return void 0===c&&(c=function(){}),f(this,void 0,void 0,function(){var e,n,i,r,o,a=this;return g(this,function(t){return e=this.canvas.nativeElement,n=e.getContext("2d",{willReadFrequently:!0}),s instanceof HTMLImageElement&&(e.width=s.naturalWidth,e.height=s.naturalHeight,s.style.visibility="",this.video.nativeElement.style.visibility="hidden",this.video.nativeElement.style.height=e.offsetHeight+"px"),s instanceof HTMLVideoElement&&(e.width=s.videoWidth,e.height=s.videoHeight,s.style.visibility="",this.canvas.nativeElement.style.visibility="hidden"),n.clearRect(0,0,e.width,e.height),n.drawImage(s,0,0,e.width,e.height),i=n.getImageData(0,0,e.width,e.height),(r=p(i.data,i.width,i.height,{inversionAttempts:"dontInvert"}))&&""!==r.data?(l(r,this.canvas.nativeElement,this.resultsPanel.nativeElement,this.canvasStyles),o=function(){a.eventEmit(r),a.dataForResize=r},s instanceof HTMLImageElement&&(c(!0),o(),w(this.vibrate),v(this.isBeep)),s instanceof HTMLVideoElement&&(o(),w(this.vibrate),v(this.isBeep))):(c(!1),b(this.resultsPanel.nativeElement),this.dataForResize=r),[2]})})},t.prototype.eventEmit=function(t){void 0===t&&(t=!1),!1!==t&&this.data.next(t||{data:null}),!1!==t&&this.event.emit(t||{data:null})},t.prototype.requestAnimationFrame=function(t){var e=this;void 0===t&&(t=0),this.rAF_ID=setInterval(function(){e.video.nativeElement.readyState===e.video.nativeElement.HAVE_ENOUGH_DATA&&(t=0,e.drawImage(e.video.nativeElement))},t||this.fps)},Object.defineProperty(t.prototype,"isReady",{get:function(){return this.ready},enumerable:!0,configurable:!0}),t.prototype.ngOnDestroy=function(){this.pause()},t.decorators=[{type:e.Component,args:[{selector:"ngx-scanner-qrcode-single",template:'<div #resultsPanel class="origin-overlay"></div><canvas #canvas class="origin-canvas"></canvas><video #video playsinline class="origin-video"></video>',host:{"class":"ngx-scanner-qrcode-single"},exportAs:"scanner",inputs:["src","fps","vibrate","isBeep","config","constraints","canvasStyles"],outputs:["event"],queries:{video:new e.ViewChild("video"),canvas:new e.ViewChild("canvas"),resultsPanel:new e.ViewChild("resultsPanel")},encapsulation:e.ViewEncapsulation.None,styles:[".ngx-scanner-qrcode-single{display:block;position:relative}.origin-overlay{width:100%;position:absolute}.origin-overlay span{z-index:2;color:red;text-align:left;position:absolute}.origin-overlay .qrcode-polygon{z-index:1;position:absolute}.origin-canvas{width:100%;position:absolute}.origin-video{width:100%;background-color:#262626}.qrcode-tooltip{z-index:3;position:absolute}.qrcode-tooltip:hover .qrcode-tooltip-temp{display:block;position:absolute}.qrcode-tooltip-temp{bottom:0;left:50%;padding:5px;color:#fff;text-align:left;display:none;max-width:450px;border-radius:5px;width:-moz-max-content;width:max-content;word-wrap:break-word;transform:translate(-50%);transform-style:preserve-3d;background-color:#000000d0;box-shadow:1px 1px 20px #000000e0}.qrcode-tooltip-temp .qrcode-tooltip-clipboard{cursor:pointer;margin-left:5px;fill:#fff}.qrcode-tooltip-temp .qrcode-tooltip-clipboard:active{fill:#afafaf}"]}]}],t.ctorParameters=function(){return[]},t}(),A=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{declarations:[T],exports:[T],providers:[S]}]}],t}();t.NgxScannerQrcodeSingleService=S,t.NgxScannerQrcodeSingleComponent=T,t.NgxScannerQrcodeSingleModule=A,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-scanner-qrcode-single.umd.min.js.map